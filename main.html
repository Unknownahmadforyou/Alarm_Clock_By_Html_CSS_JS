<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Alarm Clock</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #007bff;
            --primary-dark: #0056b3;
            --secondary: #6c757d;
            --success: #28a745;
            --danger: #dc3545;
            --dark: #121212;
            --darker: #0a0a0a;
            --light-text: #e0e0e0;
            --light-bg: #f8f9fa;
            --light-border: #dee2e6;
            --light-text-dark: #212529;
        }
        
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #121212, #1a1a1a, #262626);
            background-size: 400% 400%;
            animation: gradient 15s ease infinite;
            color: var(--light-text);
            min-height: 100vh;
            transition: all 0.3s ease;
        }
        
        body.light-mode {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef, #dee2e6);
            color: var(--light-text-dark);
        }
        
        .glass-panel {
            background: rgba(18, 18, 18, 0.7);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            transition: all 0.3s ease;
        }
        
        .light-mode .glass-panel {
            background: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }
        
        .clock-display {
            font-size: 3rem;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
            background: linear-gradient(90deg, #007bff, #00c6ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .light-mode .clock-display {
            text-shadow: 0 0 10px rgba(0, 123, 255, 0.3);
        }
        
        .alarm-item {
            transition: all 0.3s ease;
        }
        
        .alarm-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .tab-button {
            transition: all 0.3s ease;
            border-bottom: 2px solid transparent;
        }
        
        .tab-button.active {
            border-bottom: 2px solid var(--primary);
            background: rgba(0, 123, 255, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
        }
        
        input, select {
            background: rgba(30, 30, 30, 0.9) !important;
            border: 1px solid rgba(255, 255, 255, 0.1) !important;
            color: var(--light-text) !important;
            transition: all 0.3s ease;
        }
        
        .light-mode input, .light-mode select {
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid rgba(0, 0, 0, 0.1) !important;
            color: var(--light-text-dark) !important;
        }
        
        .light-mode .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }
        
        .light-mode .btn-primary:hover {
            background: linear-gradient(135deg, #0056b3, #007bff);
        }
        
        .light-mode .world-continent {
            background: rgba(0, 123, 255, 0.1);
            border: 1px solid rgba(0, 123, 255, 0.2);
        }
        
        .light-mode .timezone-line {
            background: rgba(0, 0, 0, 0.1);
        }
        
        .light-mode .timezone-text {
            color: rgba(0, 0, 0, 0.5);
        }
        
        .light-mode .city-marker {
            background-color: #007bff;
        }
        
        .light-mode .lap-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }
        
        /* Pulse animation for active alarms */
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 123, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 123, 255, 0); }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* World map styling */
        .world-map {
            background: rgba(18, 18, 18, 0.7);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }
        
        .timezone-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .timezone-text {
            position: absolute;
            top: 5px;
            font-size: 10px;
            color: rgba(255, 255, 255, 0.5);
        }
        
        .world-continent {
            position: absolute;
            background: rgba(0, 123, 255, 0.2);
            border: 1px solid rgba(0, 123, 255, 0.3);
            border-radius: 10px;
        }
        
        /* Stopwatch styling */
        .stopwatch-display {
            font-family: monospace;
            letter-spacing: 2px;
        }
        
        .lap-item {
            transition: all 0.3s ease;
        }
        
        .lap-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .city-marker {
            transition: all 0.3s ease;
            box-shadow: 0 0 0 0 rgba(0, 123, 255, 0.7);
        }
        
        .city-marker:hover {
            transform: scale(1.5);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.7);
        }
        
        .timezone-info {
            white-space: pre-line;
            line-height: 1.5;
        }
    </style>
</head>
<body class="p-4">
    <div class="container mx-auto max-w-6xl">
        <!-- Header -->
        <header class="flex flex-col items-center justify-center mb-6 glass-panel p-6">
            <h1 class="text-4xl font-bold text-center mb-2">Enhanced Alarm Clock</h1>
            <div id="current-time" class="clock-display text-center"></div>
            <div id="current-date" class="text-xl text-center text-gray-300 mt-2"></div>
        </header>
        
        <!-- Tab Navigation -->
        <div class="flex justify-between mb-4 overflow-x-auto glass-panel p-2">
            <button class="tab-button active px-4 py-2 rounded-lg font-medium flex items-center" data-tab="alarm">
                <i class="bi bi-alarm mr-2"></i> Alarm
            </button>
            <button class="tab-button px-4 py-2 rounded-lg font-medium flex items-center" data-tab="active-alarms">
                <i class="bi bi-bell mr-2"></i> Active Alarms
            </button>
            <button class="tab-button px-4 py-2 rounded-lg font-medium flex items-center" data-tab="stopwatch">
                <i class="bi bi-stopwatch mr-2"></i> Stopwatch
            </button>
            <button class="tab-button px-4 py-2 rounded-lg font-medium flex items-center" data-tab="world-clock">
                <i class="bi bi-clock-history mr-2"></i> World Clock
            </button>
            <button class="tab-button px-4 py-2 rounded-lg font-medium flex items-center" data-tab="world-map">
                <i class="bi bi-globe mr-2"></i> World Map
            </button>
            <button class="tab-button px-4 py-2 rounded-lg font-medium flex items-center" data-tab="settings">
                <i class="bi bi-gear mr-2"></i> Settings
            </button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Alarm Tab -->
            <div id="alarm" class="tab-pane active glass-panel p-6">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">Set Alarm</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="flex flex-col">
                        <label class="mb-2 font-medium">Hour</label>
                        <select id="alarm-hour" class="rounded px-3 py-2 bg-gray-800">
                            <!-- Hours will be added by JavaScript -->
                        </select>
                    </div>
                    <div class="flex flex-col">
                        <label class="mb-2 font-medium">Minute</label>
                        <select id="alarm-minute" class="rounded px-3 py-2 bg-gray-800">
                            <!-- Minutes will be added by JavaScript -->
                        </select>
                    </div>
                    <div class="flex flex-col">
                        <label class="mb-2 font-medium">Second</label>
                        <select id="alarm-second" class="rounded px-3 py-2 bg-gray-800">
                            <!-- Seconds will be added by JavaScript -->
                        </select>
                    </div>
                </div>
                
                <div class="mt-6">
                    <label class="mb-2 font-medium">Alarm Name</label>
                    <input id="alarm-name" type="text" placeholder="My Alarm" class="w-full rounded px-3 py-2 bg-gray-800">
                </div>
                
                <div class="mt-6">
                    <label class="mb-2 font-medium">Snooze Time (minutes)</label>
                    <input id="snooze-time" type="number" min="1" max="30" value="5" class="w-full rounded px-3 py-2 bg-gray-800">
                </div>
                
                <div class="flex mt-8 space-x-4">
                    <button id="set-alarm-btn" class="btn-primary px-5 py-2 rounded-lg font-medium flex items-center">
                        <i class="bi bi-plus-circle mr-2"></i> Set Alarm
                    </button>
                    <button id="test-sound-btn" class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg font-medium flex items-center">
                        <i class="bi bi-volume-up mr-2"></i> Test Sound
                    </button>
                </div>
            </div>
            
            <!-- Active Alarms Tab -->
            <div id="active-alarms" class="tab-pane hidden glass-panel p-6">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">Active Alarms</h2>
                <div id="alarms-container" class="space-y-4">
                    <!-- Alarms will be added by JavaScript -->
                    <div class="text-center text-gray-400 py-8">No alarms set</div>
                </div>
            </div>
            
            <!-- Stopwatch Tab -->
            <div id="stopwatch" class="tab-pane hidden glass-panel p-6">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">Stopwatch</h2>
                <div class="flex flex-col items-center">
                    <div id="stopwatch-display" class="stopwatch-display text-5xl font-mono mb-8">00:00:00.000</div>
                    
                    <div class="flex space-x-4 mb-8">
                        <button id="stopwatch-start" class="btn-primary px-5 py-2 rounded-lg font-medium flex items-center">
                            <i class="bi bi-play-fill mr-2"></i> Start
                        </button>
                        <button id="stopwatch-lap" class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg font-medium flex items-center" disabled>
                            <i class="bi bi-flag-fill mr-2"></i> Lap
                        </button>
                        <button id="stopwatch-reset" class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg font-medium flex items-center">
                            <i class="bi bi-arrow-counterclockwise mr-2"></i> Reset
                        </button>
                    </div>
                    
                    <div class="w-full">
                        <h3 class="text-xl font-medium mb-4">Lap Times</h3>
                        <div id="lap-times-container" class="max-h-64 overflow-y-auto">
                            <div class="text-center text-gray-400 py-4">No lap times recorded</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- World Clock Tab -->
            <div id="world-clock" class="tab-pane hidden glass-panel p-6">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">World Clock</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8" id="world-clocks-container">
                    <!-- World clocks will be added by JavaScript -->
                </div>
                
                <div class="mt-8 glass-panel p-4">
                    <h3 class="text-xl font-medium mb-4">Add New Clock</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="mb-2 font-medium">City Name</label>
                            <input id="city-name" type="text" placeholder="City Name" class="w-full rounded px-3 py-2 bg-gray-800">
                        </div>
                        <div>
                            <label class="mb-2 font-medium">Timezone</label>
                            <select id="timezone-select" class="w-full rounded px-3 py-2 bg-gray-800">
                                <!-- Timezones will be added by JavaScript -->
                            </select>
                        </div>
                    </div>
                    <button id="add-world-clock-btn" class="btn-primary mt-4 px-5 py-2 rounded-lg font-medium flex items-center">
                        <i class="bi bi-plus-circle mr-2"></i> Add Clock
                    </button>
                </div>
            </div>
            
            <!-- World Map Tab -->
            <div id="world-map" class="tab-pane hidden glass-panel p-6">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">World Map</h2>
                
                <div class="world-map h-96 mb-6 relative" id="world-map-container">
                    <img src="233081.svg" alt="World Map" class="w-full h-full object-cover opacity-50">
                    <!-- Time zones will be added by JavaScript -->
                    
                    <!-- Simplified continents with adjusted positioning -->
                    <div class="world-continent absolute" style="left: 15%; top: 20%; width: 15%; height: 40%;" title="North America"></div>
                    <div class="world-continent absolute" style="left: 25%; top: 65%; width: 10%; height: 25%;" title="South America"></div>
                    <div class="world-continent absolute" style="left: 45%; top: 20%; width: 8%; height: 40%;" title="Europe"></div>
                    <div class="world-continent absolute" style="left: 45%; top: 65%; width: 10%; height: 25%;" title="Africa"></div>
                    <div class="world-continent absolute" style="left: 65%; top: 20%; width: 15%; height: 50%;" title="Asia"></div>
                    <div class="world-continent absolute" style="left: 80%; top: 70%; width: 10%; height: 20%;" title="Australia"></div>
                </div>
                
                <div id="timezone-info" class="text-xl text-center mb-4">
                    Hover over the map to see local time
                </div>
            </div>
            
            <!-- Settings Tab -->
            <div id="settings" class="tab-pane hidden glass-panel p-6">
                <h2 class="text-2xl font-bold mb-6 border-b border-gray-700 pb-2">Settings</h2>
                
                <div class="space-y-6">
                    <div>
                        <h3 class="text-xl font-medium mb-4">Theme Settings</h3>
                        <div class="flex items-center">
                            <label class="switch inline-flex relative items-center cursor-pointer">
                                <input type="checkbox" id="dark-mode-toggle" class="sr-only peer" checked>
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                                <span class="ml-3 text-sm font-medium">Dark Mode</span>
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-medium mb-4">Sound Settings</h3>
                        <div class="flex flex-col space-y-4">
                            <input type="file" id="alarm-sound-input" accept="audio/*" class="hidden">
                            <button id="select-sound-btn" class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg font-medium flex items-center">
                                <i class="bi bi-music-note-beamed mr-2"></i> Select Alarm Sound
                            </button>
                            <button id="preview-sound-btn" class="bg-gray-700 hover:bg-gray-600 px-5 py-2 rounded-lg font-medium flex items-center">
                                <i class="bi bi-play-circle mr-2"></i> Preview Sound
                            </button>
                            <div id="current-sound" class="mt-2 text-gray-300">Current: Default Sound</div>
                        </div>
                    </div>
                    
                    <div>
                        <h3 class="text-xl font-medium mb-4">Application Info</h3>
                        <div class="glass-panel p-4">
                            <p>Enhanced Alarm Clock</p>
                            <p>Version 3.0</p>
                            <p class="mt-2">A feature-rich time management application with:</p>
                            <ul class="list-disc pl-5 mt-1">
                                <li>Alarm clock with snooze</li>
                                <li>Stopwatch with lap times</li>
                                <li>World clock with multiple time zones</li>
                                <li>World map visualization</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Footer -->
        <footer class="mt-8 text-center text-gray-500 py-4">
            <p>Enhanced Alarm Clock by Md. Sakib Ahmad | Version 3.0</p>
        </footer>
    </div>
    
    <!-- Alarm Sound (hidden) -->
    <audio id="alarm-sound" src="https://cdn.jsdelivr.net/gh/anars/blank-audio/1-second-of-silence.mp3" preload="auto"></audio>
    
    <!-- Alarm Notification Modal -->
    <div id="alarm-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
        <div class="glass-panel p-6 max-w-md w-full mx-4 pulse">
            <h2 class="text-2xl font-bold mb-4" id="alarm-modal-title">Alarm!</h2>
            <p class="text-xl mb-6" id="alarm-modal-time"></p>
            <div class="flex justify-between">
                <button id="snooze-alarm-btn" class="bg-blue-700 hover:bg-blue-600 px-5 py-2 rounded-lg font-medium">
                    Snooze
                </button>
                <button id="stop-alarm-btn" class="bg-red-700 hover:bg-red-600 px-5 py-2 rounded-lg font-medium">
                    Stop
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let alarms = [];
        let activeAlarms = {};
        let snoozeTime = 5;
        let darkMode = true;
        let alarmSound = "https://cdn.jsdelivr.net/gh/anars/blank-audio/1-second-of-silence.mp3";
        let stopwatchRunning = false;
        let stopwatchStart = 0;
        let stopwatchElapsed = 0;
        let stopwatchInterval;
        let lapTimes = [];
        let worldClocks = [
            {city: "New York", timezone: "America/New_York"},
            {city: "London", timezone: "Europe/London"},
            {city: "Tokyo", timezone: "Asia/Tokyo"},
            {city: "Sydney", timezone: "Australia/Sydney"}
        ];
        
        // Initialize application
        document.addEventListener('DOMContentLoaded', () => {
            initTimeDisplay();
            initAlarmControls();
            initStopwatch();
            initWorldClocks();
            initWorldMap();
            initTabNavigation();
            initSettings();
            
            // Load settings (placeholder for now)
            loadSettings();
        });
        
        // Tab Navigation
        function initTabNavigation() {
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and hide all panes
                    tabButtons.forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.classList.add('hidden');
                    });
                    
                    // Add active class to clicked button and show corresponding pane
                    button.classList.add('active');
                    const tabId = button.dataset.tab;
                    document.getElementById(tabId).classList.remove('hidden');
                });
            });
        }
        
        // Current Time Display
        function initTimeDisplay() {
            // Add hours to dropdown
            const hourSelect = document.getElementById('alarm-hour');
            for (let i = 0; i < 24; i++) {
                const option = document.createElement('option');
                option.value = i.toString().padStart(2, '0');
                option.textContent = i.toString().padStart(2, '0');
                hourSelect.appendChild(option);
            }
            
            // Add minutes and seconds to dropdowns
            const minuteSelect = document.getElementById('alarm-minute');
            const secondSelect = document.getElementById('alarm-second');
            for (let i = 0; i < 60; i++) {
                const minuteOption = document.createElement('option');
                minuteOption.value = i.toString().padStart(2, '0');
                minuteOption.textContent = i.toString().padStart(2, '0');
                minuteSelect.appendChild(minuteOption);
                
                const secondOption = document.createElement('option');
                secondOption.value = i.toString().padStart(2, '0');
                secondOption.textContent = i.toString().padStart(2, '0');
                secondSelect.appendChild(secondOption);
            }
            
            // Set current time as default
            const now = new Date();
            hourSelect.value = now.getHours().toString().padStart(2, '0');
            minuteSelect.value = now.getMinutes().toString().padStart(2, '0');
            secondSelect.value = '00';
            
            // Update time display
            updateTimeDisplay();
            setInterval(updateTimeDisplay, 1000);
        }
        
        function updateTimeDisplay() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            const dateElement = document.getElementById('current-date');
            
            // Update time
            timeElement.textContent = now.toLocaleTimeString('en-US', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Update date
            dateElement.textContent = now.toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Check alarms
            checkAlarms();
        }
        
        // Alarm Functions
        function initAlarmControls() {
            // Set alarm button
            document.getElementById('set-alarm-btn').addEventListener('click', setAlarm);
            
            // Test sound button
            document.getElementById('test-sound-btn').addEventListener('click', testAlarmSound);
            
            // Alarm modal buttons
            document.getElementById('snooze-alarm-btn').addEventListener('click', snoozeAlarm);
            document.getElementById('stop-alarm-btn').addEventListener('click', stopAlarm);
        }
        
        function setAlarm() {
            const hour = document.getElementById('alarm-hour').value;
            const minute = document.getElementById('alarm-minute').value;
            const second = document.getElementById('alarm-second').value;
            const alarmTime = `${hour}:${minute}:${second}`;
            let alarmName = document.getElementById('alarm-name').value;
            
            if (!alarmName) {
                alarmName = "My Alarm";
            }
            
            // Create alarm object
            const alarm = {
                time: alarmTime,
                name: alarmName,
                active: true,
                id: Date.now() // Unique ID for this alarm
            };
            
            // Add to alarms array
            alarms.push(alarm);
            
            // Update UI
            updateAlarmsDisplay();
            
            // Show confirmation
            showNotification(`Alarm "${alarmName}" set for ${alarmTime}`);
            
            // Save settings
            saveSettings();
        }
        
        function checkAlarms() {
            const now = new Date();
            const currentTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            alarms.forEach(alarm => {
                if (alarm.active && alarm.time === currentTime) {
                    // Trigger alarm
                    triggerAlarm(alarm);
                }
            });
        }
        
        function triggerAlarm(alarm) {
            // Play sound
            const sound = document.getElementById('alarm-sound');
            sound.src = alarmSound;
            sound.loop = true; // Make the alarm sound loop
            
            // Reset the sound state
            sound.currentTime = 0;
            sound.volume = 1.0;
            
            // Play the sound with error handling
            const playPromise = sound.play();
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.error('Error playing alarm sound:', error);
                    showNotification('Error playing alarm sound. Please check your sound settings.', 'error');
                });
            }
            
            // Show modal
            const modal = document.getElementById('alarm-modal');
            modal.style.display = 'flex';
            
            // Set modal content
            document.getElementById('alarm-modal-title').textContent = alarm.name;
            document.getElementById('alarm-modal-time').textContent = `Time: ${alarm.time}`;
            
            // Store current alarm for snooze
            window.currentAlarm = alarm;
        }
        
        function snoozeAlarm() {
            // Stop sound
            const sound = document.getElementById('alarm-sound');
            sound.pause();
            sound.currentTime = 0;
            sound.loop = false; // Disable looping
            
            // Hide modal
            document.getElementById('alarm-modal').style.display = 'none';
            
            // Calculate new alarm time
            const now = new Date();
            now.setMinutes(now.getMinutes() + snoozeTime);
            const newTime = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            
            // Create snoozed alarm
            const snoozedAlarm = {
                time: newTime,
                name: `${window.currentAlarm.name} (Snoozed)`,
                active: true,
                id: Date.now()
            };
            
            // Add to alarms
            alarms.push(snoozedAlarm);
            
            // Update UI
            updateAlarmsDisplay();
            
            // Show confirmation
            showNotification(`Alarm snoozed for ${snoozeTime} minutes`);
        }
        
        function stopAlarm() {
            // Stop sound
            const sound = document.getElementById('alarm-sound');
            sound.pause();
            sound.currentTime = 0;
            sound.loop = false; // Disable looping
            
            // Hide modal
            document.getElementById('alarm-modal').style.display = 'none';
        }
        
        function updateAlarmsDisplay() {
            const container = document.getElementById('alarms-container');
            
            if (alarms.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 py-8">No alarms set</div>';
                return;
            }
            
            container.innerHTML = '';
            
            alarms.forEach(alarm => {
                const alarmElement = document.createElement('div');
                alarmElement.className = 'alarm-item glass-panel p-4 flex justify-between items-center';
                
                const alarmInfo = document.createElement('div');
                alarmInfo.innerHTML = `
                    <h3 class="text-lg font-medium">${alarm.name}</h3>
                    <p class="text-gray-400">${alarm.time}</p>
                `;
                
                const removeButton = document.createElement('button');
                removeButton.className = 'bg-red-700 hover:bg-red-600 px-3 py-1 rounded-lg text-sm';
                removeButton.textContent = 'Remove';
                removeButton.onclick = () => removeAlarm(alarm.id);
                
                alarmElement.appendChild(alarmInfo);
                alarmElement.appendChild(removeButton);
                container.appendChild(alarmElement);
            });
        }
        
        function removeAlarm(id) {
            alarms = alarms.filter(alarm => alarm.id !== id);
            updateAlarmsDisplay();
            saveSettings();
        }
        
        function testAlarmSound() {
            const sound = document.getElementById('alarm-sound');
            sound.src = alarmSound;
            sound.play();
            
            showNotification('Testing alarm sound...');
        }
        
        // Stopwatch Functions
        function initStopwatch() {
            document.getElementById('stopwatch-start').addEventListener('click', toggleStopwatch);
            document.getElementById('stopwatch-lap').addEventListener('click', recordLap);
            document.getElementById('stopwatch-reset').addEventListener('click', resetStopwatch);
        }
        
        function toggleStopwatch() {
            const startButton = document.getElementById('stopwatch-start');
            const lapButton = document.getElementById('stopwatch-lap');
            
            if (!stopwatchRunning) {
                // Start stopwatch
                stopwatchRunning = true;
                stopwatchStart = Date.now() - stopwatchElapsed;
                startButton.innerHTML = '<i class="bi bi-pause-fill mr-2"></i> Pause';
                lapButton.disabled = false;
                updateStopwatch();
            } else {
                // Stop stopwatch
                stopwatchRunning = false;
                stopwatchElapsed = Date.now() - stopwatchStart;
                startButton.innerHTML = '<i class="bi bi-play-fill mr-2"></i> Resume';
                lapButton.disabled = true;
                clearInterval(stopwatchInterval);
            }
        }
        
        function updateStopwatch() {
            if (stopwatchRunning) {
                const elapsed = Date.now() - stopwatchStart;
                document.getElementById('stopwatch-display').textContent = formatStopwatchTime(elapsed);
                stopwatchInterval = setTimeout(updateStopwatch, 10); // Update every 10ms for millisecond precision
            }
        }
        
        function formatStopwatchTime(milliseconds) {
            const totalSeconds = milliseconds / 1000;
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);
            const ms = Math.floor((milliseconds % 1000) / 10);
            
            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}.${ms.toString().padStart(2, '0')}`;
        }
        
        function recordLap() {
            if (stopwatchRunning) {
                const elapsed = Date.now() - stopwatchStart;
                const lapTime = formatStopwatchTime(elapsed);
                lapTimes.push(lapTime);
                
                const container = document.getElementById('lap-times-container');
                if (lapTimes.length === 1) {
                    container.innerHTML = '';
                }
                
                const lapElement = document.createElement('div');
                lapElement.className = 'lap-item p-2 border-b border-gray-700 flex justify-between';
                lapElement.innerHTML = `
                    <span>Lap ${lapTimes.length}</span>
                    <span class="font-mono">${lapTime}</span>
                `;
                
                container.appendChild(lapElement);
            }
        }
        
        function resetStopwatch() {
            stopwatchRunning = false;
            stopwatchElapsed = 0;
            clearInterval(stopwatchInterval);
            
            document.getElementById('stopwatch-display').textContent = '00:00:00.00';
            document.getElementById('stopwatch-start').innerHTML = '<i class="bi bi-play-fill mr-2"></i> Start';
            document.getElementById('stopwatch-lap').disabled = true;
            
            lapTimes = [];
            document.getElementById('lap-times-container').innerHTML = '<div class="text-center text-gray-400 py-4">No lap times recorded</div>';
        }
        
        // World Clock Functions
        function initWorldClocks() {
            // Populate timezone dropdown
            const timezoneSelect = document.getElementById('timezone-select');
            
            // Sample timezones (add more as needed)
            const popularTimezones = [
                "America/New_York", 
                "America/Chicago", 
                "America/Denver", 
                "America/Los_Angeles",
                "Europe/London",
                "Europe/Paris", 
                "Europe/Berlin",
                "Asia/Tokyo", 
                "Asia/Shanghai", 
                "Australia/Sydney",
                "Pacific/Auckland"
            ];
            
            popularTimezones.forEach(tz => {
                const option = document.createElement('option');
                option.value = tz;
                option.textContent = tz;
                timezoneSelect.appendChild(option);
            });
            
            // Add clock button
            document.getElementById('add-world-clock-btn').addEventListener('click', addWorldClock);
            
            // Create initial clocks
            updateWorldClockDisplay();
            
            // Update world clocks every second
            setInterval(updateWorldClockTimes, 1000);
        }
        
        function addWorldClock() {
            const cityName = document.getElementById('city-name').value;
            const timezone = document.getElementById('timezone-select').value;
            
            if (!cityName || !timezone) {
                showNotification('Please enter both city name and timezone', 'error');
                return;
            }
            
            // Add to world clocks
            worldClocks.push({
                city: cityName,
                timezone: timezone
            });
            
            // Update display
            updateWorldClockDisplay();
            
            // Clear inputs
            document.getElementById('city-name').value = '';
            
            // Save settings
            saveSettings();
            
            showNotification(`Added ${cityName} world clock`);
        }
        
        function updateWorldClockDisplay() {
            const container = document.getElementById('world-clocks-container');
            container.innerHTML = '';
            
            worldClocks.forEach((clock, index) => {
                const clockElement = document.createElement('div');
                clockElement.className = 'world-clock glass-panel p-4';
                clockElement.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="text-xl font-medium">${clock.city}</h3>
                        <button class="text-gray-400 hover:text-red-500" onclick="removeWorldClock(${index})">
                            <i class="bi bi-x-circle"></i>
                        </button>
                    </div>
                    <p class="text-sm text-gray-400">${clock.timezone}</p>
                    <div class="world-clock-time text-3xl font-mono mt-2" id="world-clock-${index}"></div>
                `;
                
                container.appendChild(clockElement);
            });
            
            // Update times immediately
            updateWorldClockTimes();
        }
        
        function updateWorldClockTimes() {
            worldClocks.forEach((clock, index) => {
                const clockElement = document.getElementById(`world-clock-${index}`);
                if (clockElement) {
                    try {
                        const options = {
                            hour12: false,
                            hour: '2-digit',
                            minute: '2-digit',
                            second: '2-digit'
                        };
                        
                        const time = new Date().toLocaleTimeString('en-US', {
                            ...options,
                            timeZone: clock.timezone
                        });
                        
                        clockElement.textContent = time;
                    } catch (error) {
                        clockElement.textContent = "Invalid timezone";
                    }
                }
            });
        }
        
        // This function needs to be in the global scope for the onclick handler
        window.removeWorldClock = function(index) {
            worldClocks.splice(index, 1);
            updateWorldClockDisplay();
            saveSettings();
        };
        
        // World Map Functions
        function initWorldMap() {
            const container = document.getElementById('world-map-container');
            
            // Add timezone lines and labels
            for (let i = -12; i <= 14; i++) {
                const position = ((i + 12) / 26 * 100);
                
                // Add line
                const line = document.createElement('div');
                line.className = 'timezone-line';
                line.style.left = `${position}%`;
                container.appendChild(line);
                
                // Add label
                const label = document.createElement('div');
                label.className = 'timezone-text';
                label.style.left = `${position}%`;
                label.textContent = `UTC${i >= 0 ? '+' + i : i}`;
                container.appendChild(label);
            }
            
            // Add major cities and their timezones
            const majorCities = [
                { name: "New York", timezone: "America/New_York", x: 20, y: 30 },
                { name: "London", timezone: "Europe/London", x: 45, y: 25 },
                { name: "Paris", timezone: "Europe/Paris", x: 48, y: 30 },
                { name: "Tokyo", timezone: "Asia/Tokyo", x: 80, y: 30 },
                { name: "Sydney", timezone: "Australia/Sydney", x: 85, y: 70 },
                { name: "Moscow", timezone: "Europe/Moscow", x: 55, y: 25 },
                { name: "Dubai", timezone: "Asia/Dubai", x: 60, y: 40 },
                { name: "Singapore", timezone: "Asia/Singapore", x: 75, y: 50 },
                { name: "Rio de Janeiro", timezone: "America/Sao_Paulo", x: 30, y: 70 },
                { name: "Los Angeles", timezone: "America/Los_Angeles", x: 15, y: 35 }
            ];
            
            majorCities.forEach(city => {
                const marker = document.createElement('div');
                marker.className = 'city-marker absolute w-2 h-2 bg-blue-500 rounded-full cursor-pointer';
                marker.style.left = `${city.x}%`;
                marker.style.top = `${city.y}%`;
                marker.title = `${city.name} (${city.timezone})`;
                container.appendChild(marker);
            });
            
            // Add mousemove handler for timezone info
            container.addEventListener('mousemove', showTimezoneInfo);
        }
        
        function showTimezoneInfo(event) {
            const container = document.getElementById('world-map-container');
            const rect = container.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const widthPercent = x / container.offsetWidth;
            
            // Calculate timezone from position
            const timezone = Math.floor(widthPercent * 26) - 12;
            
            // Calculate current time in that timezone
            const date = new Date();
            const utc = date.getTime() + (date.getTimezoneOffset() * 60000);
            const tzTime = new Date(utc + (3600000 * timezone));
            
            // Format time
            const formattedTime = tzTime.toLocaleTimeString('en-US', {
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            // Get major cities in this timezone
            const citiesInTimezone = [
                { name: "New York", timezone: "America/New_York" },
                { name: "London", timezone: "Europe/London" },
                { name: "Paris", timezone: "Europe/Paris" },
                { name: "Tokyo", timezone: "Asia/Tokyo" },
                { name: "Sydney", timezone: "Australia/Sydney" },
                { name: "Moscow", timezone: "Europe/Moscow" },
                { name: "Dubai", timezone: "Asia/Dubai" },
                { name: "Singapore", timezone: "Asia/Singapore" },
                { name: "Rio de Janeiro", timezone: "America/Sao_Paulo" },
                { name: "Los Angeles", timezone: "America/Los_Angeles" }
            ].filter(city => {
                const cityDate = new Date();
                const cityOffset = cityDate.toLocaleString('en-US', { timeZone: city.timezone, timeZoneName: 'longOffset' }).split(' ').pop();
                return cityOffset === `UTC${timezone >= 0 ? '+' + timezone : timezone}`;
            });
            
            // Update info display
            const citiesList = citiesInTimezone.length > 0 
                ? `\nCities: ${citiesInTimezone.map(c => c.name).join(', ')}`
                : '';
            document.getElementById('timezone-info').textContent = 
                `UTC${timezone >= 0 ? '+' + timezone : timezone}: ${formattedTime}${citiesList}`;
        }
        
        // Settings
        function initSettings() {
            // Dark mode toggle
            document.getElementById('dark-mode-toggle').addEventListener('change', (e) => {
                darkMode = e.target.checked;
                applyTheme();
                saveSettings();
            });
            
            // Select sound button
            document.getElementById('select-sound-btn').addEventListener('click', () => {
                document.getElementById('alarm-sound-input').click();
            });

            // Handle file selection
            document.getElementById('alarm-sound-input').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Check if the file is an audio file
                    if (file.type.startsWith('audio/')) {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            alarmSound = e.target.result;
                            document.getElementById('current-sound').textContent = `Current: ${file.name}`;
                            document.getElementById('alarm-sound').src = alarmSound;
                            showNotification('Alarm sound updated successfully');
                            saveSettings();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        showNotification('Please select an audio file', 'error');
                    }
                }
            });

            // Preview sound button
            document.getElementById('preview-sound-btn').addEventListener('click', () => {
                const audio = document.getElementById('alarm-sound');
                if (audio.paused) {
                    audio.play();
                    document.getElementById('preview-sound-btn').innerHTML = '<i class="bi bi-stop-circle mr-2"></i> Stop Preview';
                } else {
                    audio.pause();
                    audio.currentTime = 0;
                    document.getElementById('preview-sound-btn').innerHTML = '<i class="bi bi-play-circle mr-2"></i> Preview Sound';
                }
            });

            // Handle audio end event
            document.getElementById('alarm-sound').addEventListener('ended', () => {
                document.getElementById('preview-sound-btn').innerHTML = '<i class="bi bi-play-circle mr-2"></i> Preview Sound';
            });
        }
        
        function applyTheme() {
            if (darkMode) {
                document.body.classList.remove('light-mode');
            } else {
                document.body.classList.add('light-mode');
            }
            
            // Update all UI elements
            const elements = document.querySelectorAll('.glass-panel, input, select, .btn-primary, .world-continent, .timezone-line, .timezone-text, .city-marker, .lap-item');
            elements.forEach(element => {
                if (darkMode) {
                    element.classList.remove('light-mode');
                } else {
                    element.classList.add('light-mode');
                }
            });
        }
        
        // Utility Functions
        function showNotification(message, type = 'success') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed bottom-4 right-4 p-4 rounded-lg shadow-lg z-50 ${
                type === 'success' ? 'bg-green-800' : 
                type === 'error' ? 'bg-red-800' : 
                'bg-blue-800'
            }`;
            notification.textContent = message;
            
            // Add to DOM
            document.body.appendChild(notification);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s ease';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 3000);
        }
        
        // Settings Management
        function saveSettings() {
            const settings = {
                darkMode,
                alarmSound,
                snoozeTime,
                alarms,
                worldClocks
            };
            
            // In a web app, we would use localStorage
            localStorage.setItem('alarmClockSettings', JSON.stringify(settings));
        }
        
        function loadSettings() {
            const settingsData = localStorage.getItem('alarmClockSettings');
            
            if (settingsData) {
                const settings = JSON.parse(settingsData);
                
                darkMode = settings.darkMode;
                if (settings.alarmSound && settings.alarmSound.startsWith('data:audio/')) {
                    alarmSound = settings.alarmSound;
                    document.getElementById('alarm-sound').src = alarmSound;
                } else {
                    alarmSound = "https://cdn.jsdelivr.net/gh/anars/blank-audio/1-second-of-silence.mp3";
                }
                snoozeTime = settings.snoozeTime;
                alarms = settings.alarms || [];
                worldClocks = settings.worldClocks || [
                    {city: "New York", timezone: "America/New_York"},
                    {city: "London", timezone: "Europe/London"},
                    {city: "Tokyo", timezone: "Asia/Tokyo"},
                    {city: "Sydney", timezone: "Australia/Sydney"}
                ];
                
                // Apply settings
                document.getElementById('dark-mode-toggle').checked = darkMode;
                document.getElementById('snooze-time').value = snoozeTime;
                document.getElementById('current-sound').textContent = `Current: ${alarmSound.startsWith('data:audio/') ? 'Custom Sound' : 'Default Sound'}`;
                
                // Update UI
                applyTheme();
                updateAlarmsDisplay();
                updateWorldClockDisplay();
            }
        }
    </script>
</body>
</html>